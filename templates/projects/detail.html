{% extends "base.html" %}
{% block content %}
  <h2>{{ project.title }}</h2>
  <p>{{ project.details }}</p>
  <p>Target: {{ project.target_amount }}</p>
  <p>Collected: {{ project.current_amount }}</p>
  <p>Progress: {{ project.progress }}%</p>
  <p>Average Rating: {{ rating|default:"No rating yet" }}</p>
  {% if user.is_authenticated %}
    <a href="{% url 'projects:report' title=project.title %}"
       class="btn btn-danger btn-sm">Report Project</a>
  {% endif %}
  {% if project.cancellable and user == project.creator %}
    <form method="post" action="{% url 'projects:cancel' project.title %}">
      {% csrf_token %}
      <button type="submit"
              onclick="return confirm('Are you sure you want to cancel this project? This action cannot be undone.');"
              class="btn btn-warning">Cancel Project</button>
    </form>
  {% endif %}
  <h3>Donate</h3>
  {% if user.is_authenticated %}
    <form method="post" action="{% url 'projects:donate' project.title %}">
      {% csrf_token %}
      <input type="number"
             step="0.01"
             name="amount"
             required
             class="form-control d-inline-block w-auto">
      <button type="submit" class="btn btn-primary">Donate</button>
    </form>
  {% else %}
    <p>Login to be able to donate.</p>
  {% endif %}
  <h3>Project Images</h3>
  <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% for image in project.images.all %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <img src="{{ image.image.url }}" class="d-block w-100">
        </div>
      {% empty %}
        <div class="carousel-item active">
          <p>No images uploaded yet.</p>
        </div>
      {% endfor %}
    </div>
    <button class="carousel-control-prev"
            type="button"
            data-bs-target="#carouselExample"
            data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next"
            type="button"
            data-bs-target="#carouselExample"
            data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>
  <h3>Comments</h3>
  <ul>
    {% for comment in comments %}
      <li>
        <b>{{ comment.user.username }}</b>: {{ comment.content }}
        <small>({{ comment.created_at|date:"Y-m-d H:i" }})</small>
        {% if user.is_authenticated %}
          <a href="{% url 'projects:report' comment_id=comment.id %}"
             class="btn btn-danger btn-sm">Report</a>
        {% endif %}
      </li>
    {% empty %}
      <li>No comments yet.</li>
    {% endfor %}
  </ul>
  {% if user.is_authenticated %}
    <form method="post" action="{% url 'projects:comment' project.title %}">
      {% csrf_token %}
      {{ forms.comment.as_p }}
      <button type="submit" class="btn btn-primary">Add Comment</button>
    </form>
  {% else %}
    <p>Login to be able to comment.</p>
  {% endif %}
  <h3>Rate this project</h3>
  {% if user.is_authenticated %}
    <form method="post" action="{% url 'projects:rate' project.title %}">
      {% csrf_token %}
      {{ forms.rating.as_p }}
      <button type="submit" class="btn btn-primary">Submit Rating</button>
    </form>
  {% else %}
    <p>Login to be able to rate.</p>
  {% endif %}
  <h3>Similar Projects</h3>
  <ul>
    {% for sp in similar_projects %}
      <li>
        <a href="{% url 'projects:detail' sp.title %}">{{ sp.title }}</a>
      </li>
    {% empty %}
      <li>No similar projects found.</li>
    {% endfor %}
  </ul>
{% endblock content %}
